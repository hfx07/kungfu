# Restore old style debuginfo creation for rpm >= 4.14.
%undefine _debugsource_packages
%undefine _debuginfo_subpackages

# -*- rpm-spec -*-
BuildRoot:      %_topdir/kungfu-0.0.5-Linux
Summary:        Kungfu Master Trading System
Name:           kungfu
Version:        0.0.5
Release:        20180520142550
License:        unknown
Group:          kungfu
Vendor:         taurus.ai


Requires: rfoo >= 1.3.1, pid >= 2.1.1, log4cplus2 == 2.0.0_RC1, supervisor >= 3.1.0









Autoreq:  no


Prefix: /opt/kungfu/master





%define _rpmdir %_topdir/RPMS
%define _srcrpmdir %_topdir/SRPMS
%define _rpmfilename kungfu-0.0.5-Linux.rpm
%define _unpackaged_files_terminate_build 0




%description
Git Version : ea024f2749193f81abd9f103cb6f07b6b8642307
Build System: Linux-4.13.0-41-generic
CMake       : /usr/local/bin/cmake
Builder     : hufx
Time        : 20180520142550


# This is a shortcutted spec file generated by CMake RPM generator
# we skip _install step because CPack does that for us.
# We do only save CPack installed tree in _prepr
# and then restore it in build.
%prep
mv $RPM_BUILD_ROOT %_topdir/tmpBBroot

%install
if [ -e $RPM_BUILD_ROOT ];
then
  rm -rf $RPM_BUILD_ROOT
fi
mv %_topdir/tmpBBroot $RPM_BUILD_ROOT



%clean

%post

#!/bin/sh

KUNGFU_HOME_DIR=/opt/kungfu

KUNGFU_DATA_DIR=/shared/kungfu
KUNGFU_SOCKETS_DIR=$KUNGFU_DATA_DIR/socket
KUNGFU_LOGGING_DIR=$KUNGFU_DATA_DIR/log
KUNGFU_PID_DIR=$KUNGFU_DATA_DIR/pid
KUNGFU_RUNTIME_DIR=$KUNGFU_DATA_DIR/runtime
KUNGFU_JOURNAL_DIR=$KUNGFU_DATA_DIR/journal

groupadd -f --system --gid 666 bruce
useradd -p `openssl passwd -1 master` -m -d $KUNGFU_HOME_DIR --system --uid 666 -g bruce -G bruce,sudo --shell=/bin/bash bruce

cat <<EOT > $KUNGFU_HOME_DIR/.bashrc
if [ -f /etc/bashrc ]; then
        . /etc/bashrc
fi
EOT
chown -R bruce:bruce $KUNGFU_HOME_DIR

mkdir -p $KUNGFU_SOCKETS_DIR

mkdir -p $KUNGFU_LOGGING_DIR
mkdir -p $KUNGFU_LOGGING_DIR/supervisor
mkdir -p $KUNGFU_LOGGING_DIR/wingchun
mkdir -p $KUNGFU_LOGGING_DIR/strategy

mkdir -p $KUNGFU_PID_DIR

mkdir -p $KUNGFU_RUNTIME_DIR

mkdir -p $KUNGFU_JOURNAL_DIR
mkdir -p $KUNGFU_JOURNAL_DIR/system
mkdir -p $KUNGFU_JOURNAL_DIR/strategy
mkdir -p $KUNGFU_JOURNAL_DIR/user
mkdir -p $KUNGFU_JOURNAL_DIR/MD/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/MD_RAW/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_RAW/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_SEND/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_Q/CTP
mkdir -p $KUNGFU_JOURNAL_DIR/MD/XTP
mkdir -p $KUNGFU_JOURNAL_DIR/MD_RAW/XTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD/XTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_RAW/XTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_SEND/XTP
mkdir -p $KUNGFU_JOURNAL_DIR/TD_Q/XTP

chown -R bruce:bruce $KUNGFU_DATA_DIR

chmod +x /opt/kungfu/master/bin/*
ln -sf /opt/kungfu/master/bin/yjj /usr/bin/yjj
ln -sf /opt/kungfu/master/bin/wingchun /usr/bin/wingchun
ln -sf /opt/kungfu/master/bin/kungfuctl /usr/bin/kungfuctl

cat <<EOT > /usr/lib64/python2.7/site-packages/kungfu.pth
/opt/kungfu/master/lib/python2.7/site-packages
EOT

ln -sf /opt/kungfu/master/etc/systemd/user/kungfu.service /etc/systemd/system/kungfu.service

systemctl daemon-reload
systemctl start kungfu


%postun
#!/bin/sh
export LC_ALL=C

rm -f /etc/systemd/system/kungfu.service

systemctl daemon-reload

rm -f /usr/bin/yjj
rm -f /usr/bin/wingchun
rm -f /usr/bin/kungfuctl

rm -f /usr/lib64/python2.7/site-packages/kungfu.pth
rm -rf /opt/kungfu/master/lib

%pre
#!/usr/bin/env bash

%preun
#!/bin/sh
systemctl stop kungfu

%files
%defattr(-,root,root,-)
%dir "/opt/kungfu/master"
%dir "/opt/kungfu/master/bin"
"/opt/kungfu/master/bin/journal_dumper"
"/opt/kungfu/master/bin/journal_tool"
"/opt/kungfu/master/bin/kungfuctl"
"/opt/kungfu/master/bin/td_pos_tool"
"/opt/kungfu/master/bin/wc_printer"
"/opt/kungfu/master/bin/wingchun"
"/opt/kungfu/master/bin/yjj"
%dir "/opt/kungfu/master/etc"
%dir "/opt/kungfu/master/etc/kungfu"
"/opt/kungfu/master/etc/kungfu/kungfu.json.sample"
%dir "/opt/kungfu/master/etc/log4cplus"
"/opt/kungfu/master/etc/log4cplus/default.properties"
"/opt/kungfu/master/etc/log4cplus/strategy.pattern"
%dir "/opt/kungfu/master/etc/supervisor"
%dir "/opt/kungfu/master/etc/supervisor/conf.d"
"/opt/kungfu/master/etc/supervisor/conf.d/md_ctp.conf"
"/opt/kungfu/master/etc/supervisor/conf.d/md_xtp.conf"
"/opt/kungfu/master/etc/supervisor/conf.d/td_ctp.conf"
"/opt/kungfu/master/etc/supervisor/conf.d/td_xtp.conf"
"/opt/kungfu/master/etc/supervisor/conf.d/yijinjing.conf"
"/opt/kungfu/master/etc/supervisor/supervisord.conf"
%dir "/opt/kungfu/master/etc/sysconfig"
"/opt/kungfu/master/etc/sysconfig/kungfu"
%dir "/opt/kungfu/master/etc/systemd"
%dir "/opt/kungfu/master/etc/systemd/user"
"/opt/kungfu/master/etc/systemd/user/kungfu.service"
%dir "/opt/kungfu/master/include"
"/opt/kungfu/master/include/FeeHandler.hpp"
"/opt/kungfu/master/include/Frame.hpp"
"/opt/kungfu/master/include/FrameHeader.h"
"/opt/kungfu/master/include/Hash.hpp"
"/opt/kungfu/master/include/IJournalVisitor.h"
"/opt/kungfu/master/include/IPageProvider.h"
"/opt/kungfu/master/include/IStrategyUtil.h"
"/opt/kungfu/master/include/IWCDataProcessor.h"
"/opt/kungfu/master/include/IWCStrategy.h"
"/opt/kungfu/master/include/Journal.h"
"/opt/kungfu/master/include/JournalFinder.h"
"/opt/kungfu/master/include/JournalHandler.h"
"/opt/kungfu/master/include/JournalReader.h"
"/opt/kungfu/master/include/JournalWriter.h"
"/opt/kungfu/master/include/KfLog.h"
"/opt/kungfu/master/include/Page.h"
"/opt/kungfu/master/include/PageCommStruct.h"
"/opt/kungfu/master/include/PageHeader.h"
"/opt/kungfu/master/include/PageProvider.h"
"/opt/kungfu/master/include/PageSocketStruct.h"
"/opt/kungfu/master/include/PageUtil.h"
"/opt/kungfu/master/include/PosHandler.hpp"
"/opt/kungfu/master/include/StrategySocketHandler.h"
"/opt/kungfu/master/include/StrategyUtil.h"
"/opt/kungfu/master/include/Timer.h"
"/opt/kungfu/master/include/TypeConvert.hpp"
"/opt/kungfu/master/include/WCDataWrapper.h"
"/opt/kungfu/master/include/WCStrategyUtil.h"
"/opt/kungfu/master/include/WC_DECLARE.h"
"/opt/kungfu/master/include/YJJ_DECLARE.h"
"/opt/kungfu/master/include/constants.h"
%dir "/opt/kungfu/master/include/ctp"
"/opt/kungfu/master/include/ctp/ThostFtdcMdApi.h"
"/opt/kungfu/master/include/ctp/ThostFtdcTraderApi.h"
"/opt/kungfu/master/include/ctp/ThostFtdcUserApiDataType.h"
"/opt/kungfu/master/include/ctp/ThostFtdcUserApiStruct.h"
"/opt/kungfu/master/include/ctp/error.dtd"
"/opt/kungfu/master/include/ctp/error.xml"
"/opt/kungfu/master/include/json.hpp"
%dir "/opt/kungfu/master/include/longfist"
"/opt/kungfu/master/include/longfist/LFConstants.h"
"/opt/kungfu/master/include/longfist/LFDataStruct.h"
"/opt/kungfu/master/include/longfist/LFPrintUtils.h"
"/opt/kungfu/master/include/longfist/LFUtils.h"
"/opt/kungfu/master/include/longfist/ctp.h"
"/opt/kungfu/master/include/longfist/sys_messages.h"
"/opt/kungfu/master/include/longfist/transfer_m.h"
"/opt/kungfu/master/include/longfist/xtp.h"
%dir "/opt/kungfu/master/include/xtp"
"/opt/kungfu/master/include/xtp/xoms_api_fund_struct.h"
"/opt/kungfu/master/include/xtp/xoms_api_struct.h"
"/opt/kungfu/master/include/xtp/xquote_api_struct.h"
"/opt/kungfu/master/include/xtp/xtp_api_data_type.h"
"/opt/kungfu/master/include/xtp/xtp_api_struct.h"
"/opt/kungfu/master/include/xtp/xtp_api_struct_common.h"
"/opt/kungfu/master/include/xtp/xtp_quote_api.h"
"/opt/kungfu/master/include/xtp/xtp_trader_api.h"
%dir "/opt/kungfu/master/lib"
%dir "/opt/kungfu/master/lib/boost"
"/opt/kungfu/master/lib/boost/libboost_atomic.a"
"/opt/kungfu/master/lib/boost/libboost_atomic.so"
"/opt/kungfu/master/lib/boost/libboost_atomic.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_chrono.a"
"/opt/kungfu/master/lib/boost/libboost_chrono.so"
"/opt/kungfu/master/lib/boost/libboost_chrono.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_container.a"
"/opt/kungfu/master/lib/boost/libboost_container.so"
"/opt/kungfu/master/lib/boost/libboost_container.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_context.a"
"/opt/kungfu/master/lib/boost/libboost_context.so"
"/opt/kungfu/master/lib/boost/libboost_context.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_contract.a"
"/opt/kungfu/master/lib/boost/libboost_contract.so"
"/opt/kungfu/master/lib/boost/libboost_contract.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_coroutine.a"
"/opt/kungfu/master/lib/boost/libboost_coroutine.so"
"/opt/kungfu/master/lib/boost/libboost_coroutine.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_date_time.a"
"/opt/kungfu/master/lib/boost/libboost_date_time.so"
"/opt/kungfu/master/lib/boost/libboost_date_time.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_exception.a"
"/opt/kungfu/master/lib/boost/libboost_filesystem.a"
"/opt/kungfu/master/lib/boost/libboost_filesystem.so"
"/opt/kungfu/master/lib/boost/libboost_filesystem.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_graph.a"
"/opt/kungfu/master/lib/boost/libboost_graph.so"
"/opt/kungfu/master/lib/boost/libboost_graph.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_iostreams.a"
"/opt/kungfu/master/lib/boost/libboost_iostreams.so"
"/opt/kungfu/master/lib/boost/libboost_iostreams.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_locale.a"
"/opt/kungfu/master/lib/boost/libboost_locale.so"
"/opt/kungfu/master/lib/boost/libboost_locale.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_log.a"
"/opt/kungfu/master/lib/boost/libboost_log.so"
"/opt/kungfu/master/lib/boost/libboost_log.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_log_setup.a"
"/opt/kungfu/master/lib/boost/libboost_log_setup.so"
"/opt/kungfu/master/lib/boost/libboost_log_setup.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_c99.a"
"/opt/kungfu/master/lib/boost/libboost_math_c99.so"
"/opt/kungfu/master/lib/boost/libboost_math_c99.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_c99f.a"
"/opt/kungfu/master/lib/boost/libboost_math_c99f.so"
"/opt/kungfu/master/lib/boost/libboost_math_c99f.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_c99l.a"
"/opt/kungfu/master/lib/boost/libboost_math_c99l.so"
"/opt/kungfu/master/lib/boost/libboost_math_c99l.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_tr1.a"
"/opt/kungfu/master/lib/boost/libboost_math_tr1.so"
"/opt/kungfu/master/lib/boost/libboost_math_tr1.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_tr1f.a"
"/opt/kungfu/master/lib/boost/libboost_math_tr1f.so"
"/opt/kungfu/master/lib/boost/libboost_math_tr1f.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_math_tr1l.a"
"/opt/kungfu/master/lib/boost/libboost_math_tr1l.so"
"/opt/kungfu/master/lib/boost/libboost_math_tr1l.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_prg_exec_monitor.a"
"/opt/kungfu/master/lib/boost/libboost_prg_exec_monitor.so"
"/opt/kungfu/master/lib/boost/libboost_prg_exec_monitor.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_program_options.a"
"/opt/kungfu/master/lib/boost/libboost_program_options.so"
"/opt/kungfu/master/lib/boost/libboost_program_options.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_python.a"
"/opt/kungfu/master/lib/boost/libboost_python.so"
"/opt/kungfu/master/lib/boost/libboost_python27.a"
"/opt/kungfu/master/lib/boost/libboost_python27.so"
"/opt/kungfu/master/lib/boost/libboost_python27.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_random.a"
"/opt/kungfu/master/lib/boost/libboost_random.so"
"/opt/kungfu/master/lib/boost/libboost_random.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_regex.a"
"/opt/kungfu/master/lib/boost/libboost_regex.so"
"/opt/kungfu/master/lib/boost/libboost_regex.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_serialization.a"
"/opt/kungfu/master/lib/boost/libboost_serialization.so"
"/opt/kungfu/master/lib/boost/libboost_serialization.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_signals.a"
"/opt/kungfu/master/lib/boost/libboost_signals.so"
"/opt/kungfu/master/lib/boost/libboost_signals.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_addr2line.a"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_addr2line.so"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_addr2line.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_backtrace.a"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_backtrace.so"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_backtrace.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_basic.a"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_basic.so"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_basic.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_noop.a"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_noop.so"
"/opt/kungfu/master/lib/boost/libboost_stacktrace_noop.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_system.a"
"/opt/kungfu/master/lib/boost/libboost_system.so"
"/opt/kungfu/master/lib/boost/libboost_system.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_test_exec_monitor.a"
"/opt/kungfu/master/lib/boost/libboost_thread.a"
"/opt/kungfu/master/lib/boost/libboost_thread.so"
"/opt/kungfu/master/lib/boost/libboost_thread.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_timer.a"
"/opt/kungfu/master/lib/boost/libboost_timer.so"
"/opt/kungfu/master/lib/boost/libboost_timer.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_type_erasure.a"
"/opt/kungfu/master/lib/boost/libboost_type_erasure.so"
"/opt/kungfu/master/lib/boost/libboost_type_erasure.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_unit_test_framework.a"
"/opt/kungfu/master/lib/boost/libboost_unit_test_framework.so"
"/opt/kungfu/master/lib/boost/libboost_unit_test_framework.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_wave.a"
"/opt/kungfu/master/lib/boost/libboost_wave.so"
"/opt/kungfu/master/lib/boost/libboost_wave.so.1.67.0"
"/opt/kungfu/master/lib/boost/libboost_wserialization.a"
"/opt/kungfu/master/lib/boost/libboost_wserialization.so"
"/opt/kungfu/master/lib/boost/libboost_wserialization.so.1.67.0"
%dir "/opt/kungfu/master/lib/python2.7"
%dir "/opt/kungfu/master/lib/python2.7/site-packages"
%dir "/opt/kungfu/master/lib/python2.7/site-packages/kungfu"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/__init__.py"
%dir "/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist/__init__.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist/longfist_constants.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist/longfist_structs.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist/longfist_structs_sniffer.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/longfist/longfist_utils.py"
%dir "/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/__init__.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/constants.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/engine.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/strategy.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/supervisor.py"
"/opt/kungfu/master/lib/python2.7/site-packages/kungfu/wingchun/wc_configs.py"
%dir "/opt/kungfu/master/lib/wingchun"
"/opt/kungfu/master/lib/wingchun/libctpmd.so"
"/opt/kungfu/master/lib/wingchun/libctptd.so"
"/opt/kungfu/master/lib/wingchun/libwingchunstrategy.so"
"/opt/kungfu/master/lib/wingchun/libwingchuntool.so"
"/opt/kungfu/master/lib/wingchun/libxtpmd.so"
"/opt/kungfu/master/lib/wingchun/libxtptd.so"
%dir "/opt/kungfu/master/lib/yijinjing"
"/opt/kungfu/master/lib/yijinjing/libjournal.so"
"/opt/kungfu/master/lib/yijinjing/libjournal.so.1.1"
"/opt/kungfu/master/lib/yijinjing/libkflog.so"
"/opt/kungfu/master/lib/yijinjing/libpaged.so"
%dir "/opt/kungfu/master/lib64"
%dir "/opt/kungfu/master/lib64/api"
"/opt/kungfu/master/lib64/api/libthostmduserapi.so"
"/opt/kungfu/master/lib64/api/libthosttraderapi.so"
"/opt/kungfu/master/lib64/api/libxtpquoteapi.so"
"/opt/kungfu/master/lib64/api/libxtptraderapi.so"




%changelog
* Sun Jul 4 2010 Eric Noulard <eric.noulard@gmail.com> - 0.0.5-20180520142550
  Generated by CPack RPM (no Changelog file were provided)


